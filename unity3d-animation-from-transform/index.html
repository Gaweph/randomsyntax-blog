<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css rel=stylesheet crossorigin=anonymous integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU="> <link href="https://fonts.googleapis.com/css?family=Ubuntu:regular,bold&subset=Latin" rel=stylesheet> <link href="https://fonts.googleapis.com/css?family=Dosis:regular,bold&subset=Latin" rel=stylesheet> <link href=https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet crossorigin=anonymous integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN> <link href=global.css rel=stylesheet> <link href=color.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=client/main.105405718.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>Mecanim Animation From Transform</title><script crossorigin=anonymous integrity="sha256-XC8w+g7s6jfpD0qiG2Goj2wuZ0747UaT/E0Nf2ulmew=" src=https://cdnjs.cloudflare.com/ajax/libs/simplelightbox/2.2.1/simple-lightbox.min.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/simplelightbox/2.2.1/simple-lightbox.min.css rel=stylesheet crossorigin=anonymous integrity="sha256-UZP8fxAiI5/RA82wRNC5aN+ebMcpGxJCnDzlKzuIVXY="><script crossorigin=anonymous integrity="sha256-XC8w+g7s6jfpD0qiG2Goj2wuZ0747UaT/E0Nf2ulmew=" src=https://cdnjs.cloudflare.com/ajax/libs/simplelightbox/2.2.1/simple-lightbox.min.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/simplelightbox/2.2.1/simple-lightbox.min.css rel=stylesheet crossorigin=anonymous integrity="sha256-UZP8fxAiI5/RA82wRNC5aN+ebMcpGxJCnDzlKzuIVXY="><link href=/prism-xonokai.css rel=stylesheet><noscript id=sapper-head-end></noscript> </head> <body class=bg-main> <div id=sapper> <header class=svelte-krzlk7 id=masthead role=banner><nav><div class=navbar-bg><div class=container><div class="svelte-krzlk7 site-title"><a class="svelte-krzlk7 navbar-bg" href=/ rel=prefetch><i class="fa fa-fw fa-rocket" style=font-weight:lighter></i> <span style=font-weight:bolder>Gareth</span> <span style=font-weight:lighter>Williams</span></a></div></div></div> <div class=sub-navbar-bg><div class=container><div style=float:right;padding-right:10px><div class="svelte-1qs9g6x social-container"><a class="svelte-1qs9g6x btn-github" href=https://github.com/Gaweph rel=external target=_blank><i class="fa fa-fw fa-github"></i></a> <a class="svelte-1qs9g6x btn-twitter" href=https://twitter.com/Gaweph rel=external target=_blank><i class="fa fa-fw fa-twitter"></i></a> <a class="svelte-1qs9g6x btn-pinterest" href=https://uk.pinterest.com/gaweph rel=external target=_blank><i class="fa fa-fw fa-pinterest"></i></a></div></div> <div class="svelte-krzlk7 site-sub-title">RandomSyntax.Net</div></div> </div></nav></header> <main class="container svelte-8hnz6z"> <div class=svelte-463wh6><h1 class=title><span class=svelte-14j60n8>Mecanim Animation From Transform</span></h1> <div> <a class=svelte-ou1xnh href=/tags/software/ rel=prefetch><div class="svelte-1i03sjn tag"><span class="fa fa-tag"></span> software</div> </a><a class=svelte-ou1xnh href=/tags/unity3d/ rel=prefetch><div class="svelte-1i03sjn tag"><span class="fa fa-tag"></span> unity3d</div> </a></div></div> <div class="post-contents svelte-1uuq66r">In this post I will try to explain how I implemented simple auto animation for my characters based on their changing position in the scene (using mecanim and a simple script). <div style=max-width:700px><br> <div class="svelte-ghjj6u video-container"><iframe allowfullscreen class=svelte-ghjj6u frameborder=0 src=//player.vimeo.com/video/187484099></iframe></div> <br></div> <div class="svelte-1ecdldb bs-callout bs-callout-primary"><h3 class=svelte-1ecdldb>Position and Rotation only</h3> In the above example the only thing being manipulated is the objects position and rotation (The animations are happening automagically) </div> <h2>How to</h2> First we need to load a Mecanim <strong>Animator->Controller</strong> and a model to attach an Animator component onto. In my example I have used the classic unity model of <strong>Kyle the Robot</strong> and the standard <strong>ThirdPersonAnimatorController</strong> (Any model and controller will do). <br> <div class="svelte-6sopm9 solo-image"><a class=svelte-6sopm9 href=/content/images/unity3d-animation-from-transform/Standard_asset_Animator_Robot_kyle.png><img alt=Standard_asset_Animator_Robot_kyle class=svelte-6sopm9 src=/content/images/unity3d-animation-from-transform/Standard_asset_Animator_Robot_kyle.png> </a></div> <br> <h2>Animation States and Variables</h2> We can see that there are a few states and variables included in this controller. The variable we are interested in is <strong>Forward</strong> . <br> <div class="svelte-6sopm9 solo-image"><a class=svelte-6sopm9 href=/content/images/unity3d-animation-from-transform/ThirdPersonAnimatorController.png><img alt=ThirdPersonAnimatorController class=svelte-6sopm9 src=/content/images/unity3d-animation-from-transform/ThirdPersonAnimatorController.png> </a></div> <br> The value of <strong>Forward</strong> will determine the walk/run animation that mecanim wil animate for us. <h2>The Code</h2> <div> <pre class=svelte-1x2uof1><code class=language-csharp>using UnityEngine;
using System.Linq;

public class AnimationFromTransform : MonoBehaviour {

    public float MinMovementAmount = 1;
    public string MechanimMovementName = "Forward";
    private Animator _anim;
    void Start () {
        _prevPosition = Transform.position;
        _anim = GetComponentsInChildren&lt;Animator>().FirstOrDefault();
        if(_anim == null)
        {
            _anim = GetComponent&lt;Animator>();
        }
    }
    
    private Vector3 _prevPosition;
    void Update () {

        if (_anim != null)
        {
            Vector3 vel = (Transform.position - _prevPosition) / Time.timeScale;
            
            var movement = Mathf.Max(Mathf.Abs(vel.x), Mathf.Abs(vel.z));
            if (movement > 0f)
            {
                movement = Mathf.Max(MinMovementAmount, movement);
            }
                        
            _anim.SetFloat(MechanimMovementName, movement);

            _prevPosition = Transform.position;
        }
    }
}
</code></pre></div> <h2>Explanation</h2> Each Update() the <strong>Velocity</strong> (Vector3) of the object is taken . This value is then passed to the animator (if one exists) which sets the specified movement float (" <strong>Forward</strong> " in my example) <div class="svelte-1ecdldb bs-callout bs-callout-primary"><h3 class=svelte-1ecdldb>Velocity</h3> This is the difference between this frames transform and the previous frames transform. </div> <div class="svelte-1ecdldb bs-callout bs-callout-primary"><h3 class=svelte-1ecdldb>Note</h3> <strong>MinMovementAmount</strong> - This variable can be changed in order to get the desired effect. I found that a value of 1 produced good movements for the prototype I was implementing. </div> <h2>Usage</h2> Simply attach this script to your object that contains your character. Good luck, let me know in the comments if anything needs explaining or if this does not work for you :) </div></main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,{gistContents:"using UnityEngine;\nusing System.Linq;\n\npublic class AnimationFromTransform : MonoBehaviour {\n\n    public float MinMovementAmount = 1;\n    public string MechanimMovementName = \"Forward\";\n    private Animator _anim;\n    void Start () {\n        _prevPosition = Transform.position;\n        _anim = GetComponentsInChildren\u003CAnimator\u003E().FirstOrDefault();\n        if(_anim == null)\n        {\n            _anim = GetComponent\u003CAnimator\u003E();\n        }\n    }\n    \n    private Vector3 _prevPosition;\n    void Update () {\n\n        if (_anim != null)\n        {\n            Vector3 vel = (Transform.position - _prevPosition) \u002F Time.timeScale;\n            \n            var movement = Mathf.Max(Mathf.Abs(vel.x), Mathf.Abs(vel.z));\n            if (movement \u003E 0f)\n            {\n                movement = Mathf.Max(MinMovementAmount, movement);\n            }\n                        \n            _anim.SetFloat(MechanimMovementName, movement);\n\n            _prevPosition = Transform.position;\n        }\n    }\n}\n"}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.47898928.js"}catch(e){main="/client/legacy/client.0eb01836.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 