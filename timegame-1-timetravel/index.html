<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <title>Gareth Williams - Time Game 1 - Implementing Time Travel (Replay system)</title>      
    <link rel="icon" type="image/png" href="/images/fa-rocket_16px.png">

    <!-- Bootstrap Core CSS -->
	<link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/jasny-bootstrap-min.css">
	<link rel="stylesheet" href="/css/callouts.css">
	<link rel="stylesheet" href="/css/bootstrap-social.css">
    
    <!-- Custom Fonts -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Ubuntu:regular,bold&subset=Latin">
    <link href='//cdn.jsdelivr.net/devicons/1.8.0/css/devicons.min.css' rel='stylesheet'>
    	
    <!-- Custom Styles -->
	<link rel="stylesheet" href="/css/layout.css">    
	<link rel="stylesheet" href="/css/styles.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->    
    
</head>

<body>    		
		<!-- Sidebar -->
		<div class="navmenu navmenu-inverse navmenu-fixed-left offcanvas-sm">
	
	<div class="visible-md visible-lg">
	
		<a class="nounderline" href="/">		
			
			<div class="site-title">
				<img class="site-icon" src="/images/fa-rocket_200px.png" height="150px" />
				Gareth Williams
			</div>
			
		</a>
					
		<div class="site-description">
			RandomSyntax.Net
		</div>	
	</div>
	
	<ul class="nav navmenu-nav">
		
			<li class="">
				<a href="/">   					
					<i class="icon fa fa-home"></i>
					Home     
				</a>
			</li>
		
			<li class="">
				<a href="/categories/3D-Printer">   					
					<i class="icon fa fa-gitlab"></i>
					3D Printer     
				</a>
			</li>
		
			<li class="">
				<a href="/categories/Gamedev/Timegame/">   					
					<i class="icon fa fa-gamepad"></i>
					Time Game     
				</a>
			</li>
		
			<li class="">
				<a href="/atom.xml">   					
					<i class="icon fa fa-rss"></i>
					RSS     
				</a>
			</li>
		
	</ul>	
	
	<div class="nav btn-list"><i class="icon fa fa-tags"></i>
     
        <a href="/tags/software/">
            <button type="button" class="btn btn-primary btn-xs">					
                    software		
            </button>
        </a>
     
        <a href="/tags/automation/">
            <button type="button" class="btn btn-primary btn-xs">					
                    automation		
            </button>
        </a>
     
        <a href="/tags/hardware/">
            <button type="button" class="btn btn-primary btn-xs">					
                    hardware		
            </button>
        </a>
     
        <a href="/tags/build/">
            <button type="button" class="btn btn-primary btn-xs">					
                    build		
            </button>
        </a>
     
        <a href="/tags/setup/">
            <button type="button" class="btn btn-primary btn-xs">					
                    setup		
            </button>
        </a>
     
        <a href="/tags/config/">
            <button type="button" class="btn btn-primary btn-xs">					
                    config		
            </button>
        </a>
     
        <a href="/tags/conky/">
            <button type="button" class="btn btn-primary btn-xs">					
                    conky		
            </button>
        </a>
     
        <a href="/tags/unity3d/">
            <button type="button" class="btn btn-primary btn-xs">					
                    unity3d		
            </button>
        </a>
     
        <a href="/tags/p5/">
            <button type="button" class="btn btn-primary btn-xs">					
                    p5		
            </button>
        </a>
    
</div>


	<div class="row">
		<div class="col-sm-1 col-lg-2">		
		</div>
		<div class="col-sm-10 col-lg-8">
			<a href="https://twitter.com/Gaweph" class="btn  btn-social-icon btn-twitter">
				<i class="fa fa-twitter fa-fw"></i>
			</a>
			<a href="https://github.com/Gaweph" class="btn btn-social-icon btn-github">
				<i class="fa fa-github fa-fw"></i>
			</a>
			<a href="https://uk.pinterest.com/gaweph" class="btn btn-social-icon btn-pinterest">
				<i class="fa fa-pinterest fa-fw"></i>
			</a>
		</div>
		<div class="col-sm-1 col-lg-2">			
		</div>
	</div>
		

</div>
		
		<!-- Header -->
		<div class="navbar navbar-inverse navbar-fixed-top hidden-md hidden-lg">
	<button type="button" class="navbar-toggle" data-toggle="offcanvas" data-target=".navmenu">
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
	</button>	
			
	<a class="nounderline" href="/">
		<div class="site-title">
			<img class="site-icon" src="/images/fa-rocket_200px.png" height="25px" />
			Gareth Williams
		</div>
	</a>
		
</div>

				
		<!-- Page Content -->
		<div id="wrap">
			<div id="main" class="container-fluid clear-top">
				<div class="blog-post">

    <!-- Title -->    
    <h1 class="post-title page-header"> 
        Time Game 1 - Implementing Time Travel (Replay system)   
    </h1>

    <!-- Date and Author -->
    <p class="blog-post-meta">
        <!-- 09-10-2016 -->
        
    </p>
    
    <!-- Tags and Categories links -->
    

<div class="blog-categories-container">
    <span class="fa fa-folder"></span>
    <a href="/categories/Gamedev/">Gamedev</a> / <a href="/categories/Gamedev/Timegame/">Timegame</a>
</div>

    

<div class="blog-tags-container">
    <span class="fa fa-tags"></span>
    <a href="/tags/software/">#software</a> <a href="/tags/unity3d/">#unity3d</a>
</div>

    
    <!-- Content -->
    <p>This is my current progress of a time travel puzzle game created with Unity3D</p>
<p>&lt;div style=&quot;max-width: 700px&quot;&gt;
<div class="video-container"><iframe src="//player.vimeo.com/video/186188380" frameborder="0" allowfullscreen></iframe></div>
&lt;/div&gt;</p>
<p>I will briefly outline how I implemented time travel in Unity3d.<br>
As the title suggests, this method will be the same if you are trying to create some sort of replay system.</p>
<h2>Record</h2>
<p>The first thing we need to do is to record our players movement.
The easiest thing to do seems to be to record the players position and rotation (Transform).</p>
<p>For this we create an object which will be used to hold the recorded information.</p>
<p><figure class="highlight cs"><figcaption><span>RecordingData.cs</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RecordingData</span></div><div class="line">&#123;    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">float</span> RecordedRate &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    <span class="keyword">private</span> List&lt;RecordData&gt; recordedData = <span class="keyword">new</span> List&lt;RecordData&gt;();</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">struct</span> RecordData</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">public</span> Vector3 Position &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">        <span class="keyword">public</span> Quaternion Rotation &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddDataLine</span>(<span class="params">RecordData data</span>)</span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        recordedData.Add(data);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> pointer = <span class="number">0</span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MoveToStartOfData</span>(<span class="params"></span>)</span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        pointer = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> RecordData? GetNextDataLine()</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">var</span> count = recordedData.Count;</div><div class="line">        RecordData? data = <span class="literal">null</span>;</div><div class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span> &amp;&amp; pointer &lt; count &amp;&amp; pointer &gt;= <span class="number">0</span>) <span class="comment">// not empty and pointer is within range and pointer not negative</span></div><div class="line">        &#123;</div><div class="line">            data = recordedData[pointer];</div><div class="line">        &#125;        </div><div class="line">        pointer++;</div><div class="line">        <span class="keyword">return</span> data;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><div class="bs-callout bs-callout-warning"><h4>Note</h4>
<p>This can be extended to record more information in the future (maybe <strong>Scale</strong>?)</p>
</div></p>
<p>We then need to call a method which records the data.</p>
<p><figure class="highlight cs"><figcaption><span>TakeSnapShot()</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> RecordingData recordingData = <span class="keyword">new</span> RecordingData();</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TakeSnapshot</span>(<span class="params"></span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">var</span> t = Transform;</div><div class="line">    <span class="keyword">var</span> data = <span class="keyword">new</span> RecordData()</div><div class="line">    &#123;</div><div class="line">        Position = t.position,</div><div class="line">        Rotation = t.rotation</div><div class="line">    &#125;;</div><div class="line">    recordingData.AddDataLine(data);    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>We need to call the <strong>TakeSnapshot</strong> method at a known interval.<br>
I have used coroutines to ensure a consistent sample of data.
In the below example we are using <strong>0.05 seconds</strong> which is a rate of 20fps.
This seems to offer a smooth enough playback rate (discussed later in this article).</p>
<p><figure class="highlight cs"><figcaption><span>Record Coroutine</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">bool</span> DoRecording = <span class="literal">true</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">StartRecording</span>(<span class="params"></span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    DoRecording = <span class="literal">true</span>;</div><div class="line">    StartCoroutine(RecordingTimer(<span class="number">0.05</span>f, <span class="number">0</span>f));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//RECORDING LOOP</span></div><div class="line"><span class="function">IEnumerator <span class="title">RecordingTimer</span>(<span class="params"><span class="keyword">float</span> sampleRate</span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    recordingData.RecordedRate = sampleRate;</div><div class="line">    <span class="keyword">while</span> (DoRecording) <span class="comment">// Repeat until DoRecording is false</span></div><div class="line">    &#123;</div><div class="line">        TakeSnapshot();</div><div class="line">        <span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForSeconds</span>(<span class="params">recordingData.RecordedRate / Time.timeScale</span>)</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><div class="bs-callout bs-callout-warning"><h4>Note</h4>
<p><strong>DoRecording</strong> can be set to false to stop recording.</p>
</div></p>
<h2>Replay</h2>
<p>Then we just need to play this data back.  Again this is done with a coroutine.</p>
<p><figure class="highlight cs"><figcaption><span>Playback Coroutine</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">bool</span> DoPlayback = <span class="literal">true</span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StartPlayback</span>(<span class="params"></span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    DoPlayback = <span class="literal">true</span>;</div><div class="line">    recordingData.MoveToStartOfData(); <span class="comment">//Move to start of playback</span></div><div class="line">    StartCoroutine(PlaybackTimer());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>This is the same as the recording loop except it calls Next SnapShot().</p>
<p><figure class="highlight cs"><figcaption><span>Playback Loop</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//PLAYBACK LOOP</span></div><div class="line"><span class="function">IEnumerator <span class="title">PlaybackTimer</span>(<span class="params"></span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">while</span> (DoPlayback) <span class="comment">// Repeat Until DoPlayback is false</span></div><div class="line">    &#123;</div><div class="line">        NextSnapshot();</div><div class="line">        <span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForSeconds</span>(<span class="params">recordingData.RecordedRate / Time.timeScale</span>)</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>The <strong>NextSnapshot</strong> method simply retrieves the desired transform of the object.</p>
<p><figure class="highlight cs"><figcaption><span>NextSnapshot()</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> RecordingData.RecordData? _desiredMoveLocation = <span class="literal">null</span>;</div><div class="line"></div><div class="line"><span class="comment">//MOVE DESIRED LOCATION TO NEXT LOCATION</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">NextSnapshot</span>(<span class="params"></span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">var</span> data = recordingData.GetNextDataLine();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (_desiredMoveLocation.HasValue &amp;&amp; !data.HasValue) <span class="comment">//If we previously had move location and now we do not</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//END OF REPLAY - YOU MAY WANT TO REMOVE THE REPLAY OBJECT FROM SCENE NOW</span></div><div class="line">    &#125;</div><div class="line">    _desiredMoveLocation = data;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>We then move the object each update frame using the <strong>Lerp</strong> function (this helps keep the movement smooth).</p>
<p><figure class="highlight cs"><figcaption><span>Move Object</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span> (_desiredMoveLocation.HasValue)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">var</span> playbackRate = recordingData.RecordedRate;</div><div class="line">        <span class="keyword">var</span> amount = Math.Abs(Time.deltaTime) / playbackRate;</div><div class="line">        <span class="keyword">var</span> p = Vector3.Lerp(Transform.position, _desiredMoveLocation.Value.Position, amount);</div><div class="line">        <span class="keyword">var</span> r = Quaternion.Lerp(Transform.rotation, _desiredMoveLocation.Value.Rotation, amount);</div><div class="line"></div><div class="line">        Transform.position = p;</div><div class="line">        Transform.rotation = r;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><div class="bs-callout bs-callout-warning"><h4>This is not the only way</h4>
<p>There are many many ways of doing this.  I am outlining how I did it.
I have simplified my implementation for the purposes of this post (to outline roughly how it was done).
Any feedback or improvements are welcome :)</p>
</div></p>
<p><div class="bs-callout bs-callout-primary"><h4>Have a question?</h4>
<p>Feel free to ask me anything (I have overlooked some internal workings in this post).
I also have a Unity3d Forum WIP post for this game prototype (in progress):
<a href="https://forum.unity3d.com/threads/wip-time-game-time-travel.435684/" target="_blank" rel="external">https://forum.unity3d.com/threads/wip-time-game-time-travel.435684/</a></p>
</div></p>
<p><div class="bs-callout bs-callout-primary"><h4>More Info?</h4>
<p>I have not gone into any detail on how the replay data can be saved and loaded between games (I have implemented this in my prototype).
I can try and write a post outlining this if this is of interest?</p>
</div></p>

    
    <hr />
        
    <!-- Comments -->
    
    <div class="blog-post-comments">
        <h2>Comments:</h2>
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>

</div>
			</div>
			
			<!-- Footer -->
			<footer id="footer">
				

				

<p class="copyright text-muted">Powered by <a target="_blank" href="https://hexo.io/">Hexo</a>.</p>			
			</footer>
		</div>
	<!-- After footer scripts -->
	<!-- jQuery -->
<script src="/js/jquery.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jasny-bootstrap.min.js"></script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'randomsyntax';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>



  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>	
    
</body>

</html>