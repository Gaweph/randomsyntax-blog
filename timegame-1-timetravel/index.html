<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css rel=stylesheet crossorigin=anonymous integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU="> <link href="https://fonts.googleapis.com/css?family=Ubuntu:regular,bold&subset=Latin" rel=stylesheet> <link href="https://fonts.googleapis.com/css?family=Dosis:regular,bold&subset=Latin" rel=stylesheet> <link href=https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet crossorigin=anonymous integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN> <link href=global.css rel=stylesheet> <link href=color.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=client/main.405715190.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>Time Game 1 - Implementing Time Travel</title><link href=/content/css/prism-xonokai.css rel=stylesheet><link href=/content/css/prism-xonokai.css rel=stylesheet><link href=/content/css/prism-xonokai.css rel=stylesheet><link href=/content/css/prism-xonokai.css rel=stylesheet><link href=/content/css/prism-xonokai.css rel=stylesheet><link href=/content/css/prism-xonokai.css rel=stylesheet><link href=/content/css/prism-xonokai.css rel=stylesheet><noscript id=sapper-head-end></noscript> </head> <body class=bg-main> <div id=sapper> <header class=svelte-krzlk7 id=masthead role=banner><nav><div class=navbar-bg><div class=container><div class="svelte-krzlk7 site-title"><a href=/ rel=prefetch class="svelte-krzlk7 navbar-bg"><i class="fa fa-fw fa-rocket" style=font-weight:lighter></i> <span style=font-weight:bolder>Gareth</span> <span style=font-weight:lighter>Williams</span></a></div></div></div> <div class=sub-navbar-bg><div class=container><div style=float:right;padding-right:10px><div class="svelte-1qs9g6x social-container"><a href=https://github.com/Gaweph rel=external class="svelte-1qs9g6x btn-github" target=_blank><i class="fa fa-fw fa-github"></i></a> <a href=https://twitter.com/Gaweph rel=external class="svelte-1qs9g6x btn-twitter" target=_blank><i class="fa fa-fw fa-twitter"></i></a> <a href=https://uk.pinterest.com/gaweph rel=external class="svelte-1qs9g6x btn-pinterest" target=_blank><i class="fa fa-fw fa-pinterest"></i></a></div></div> <div class="svelte-krzlk7 site-sub-title">RandomSyntax.Net</div></div> </div></nav></header> <main class="container svelte-8hnz6z"> <div class=svelte-463wh6><h1 class=title><span class=svelte-14j60n8>Time Game 1 - Implementing Time Travel</span></h1> <div><a href=/projects/Timegame/ rel=prefetch class=svelte-ou1xnh><div class="project svelte-1uk341"><span class="fa fa-star"></span> Timegame</div> </a> <a href=/tags/software/ rel=prefetch class=svelte-ou1xnh><div class="svelte-1i03sjn tag"><span class="fa fa-tag"></span> software</div> </a><a href=/tags/unity3d/ rel=prefetch class=svelte-ou1xnh><div class="svelte-1i03sjn tag"><span class="fa fa-tag"></span> unity3d</div> </a></div></div> <div class="post-contents svelte-1uuq66r">This is my current progress of a time travel puzzle game created with Unity3D <div style=max-width:700px><br> <div class="svelte-ghjj6u video-container"><iframe allowfullscreen class=svelte-ghjj6u frameborder=0 src=//player.vimeo.com/video/186188380></iframe></div> <br></div> I will briefly outline how I implemented time travel in Unity3d. As the title suggests, this method will be the same if you are trying to create some sort of replay system. <h2>Record</h2> The first thing we need to do is to record our players movement. The easiest thing to do seems to be to record the players position and rotation (Transform). For this we create an object which will be used to hold the recorded information. <div><h4 class=svelte-1x2uof1><i class="fa fa-code"></i> RecordingData.cs</h4> <pre class=svelte-1x2uof1><code class=language-csharp>
public class RecordingData
{    
    public float RecordedRate { get; set; }
    private List&lt;RecordData> recordedData = new List&lt;RecordData>();

    public struct RecordData
    {
        public Vector3 Position { get; set; }
        public Quaternion Rotation { get; set; }
    }

    public void AddDataLine(RecordData data)
    {
        recordedData.Add(data);
    }

    public int pointer = 0;
    public void MoveToStartOfData()
    {
        pointer = 0;
    }

    public RecordData? GetNextDataLine()
    {
        var count = recordedData.Count;
        RecordData? data = null;
        if (count > 0 && pointer &lt; count && pointer >= 0) // not empty and pointer is within range and pointer not negative
        {
            data = recordedData[pointer];
        }        
        pointer++;
        return data;
    }
}</code></pre></div> <div class="svelte-1ecdldb bs-callout bs-callout-primary"><h3 class=svelte-1ecdldb>Note</h3> This can be extended to record more information in the future (maybe <strong>Scale</strong> ?) </div> We then need to call a method which records the data. <div><h4 class=svelte-1x2uof1><i class="fa fa-code"></i> TakeSnapShot()</h4> <pre class=svelte-1x2uof1><code class=language-csharp>private RecordingData recordingData = new RecordingData();
public void TakeSnapshot()
{
    var t = Transform;
    var data = new RecordData()
    {
        Position = t.position,
        Rotation = t.rotation
    };
    recordingData.AddDataLine(data);    
}</code></pre></div> We need to call the **TakeSnapshot** method at a known interval. I have used coroutines to ensure a consistent sample of data. In the below example we are using **0.05 seconds** which is a rate of 20fps. This seems to offer a smooth enough playback rate (discussed later in this article). <div><h4 class=svelte-1x2uof1><i class="fa fa-code"></i> Record Coroutine</h4> <pre class=svelte-1x2uof1><code class=language-csharp>
public bool DoRecording = true;
void StartRecording()
{
    DoRecording = true;
    StartCoroutine(RecordingTimer(0.05f, 0f));
}

//RECORDING LOOP
IEnumerator RecordingTimer(float sampleRate)
{
    recordingData.RecordedRate = sampleRate;
    while (DoRecording) // Repeat until DoRecording is false
    {
        TakeSnapshot();
        yield return new WaitForSeconds(recordingData.RecordedRate / Time.timeScale);
    }
}</code></pre></div> <div class="svelte-1ecdldb bs-callout bs-callout-primary"><h3 class=svelte-1ecdldb>Note</h3> <strong>DoRecording</strong> can be set to false to stop recording. </div> <h2>Replay</h2> Then we just need to play this data back. Again this is done with a coroutine. <div><h4 class=svelte-1x2uof1><i class="fa fa-code"></i> Playback Coroutine</h4> <pre class=svelte-1x2uof1><code class=language-csharp>
public bool DoPlayback = true;
public void StartPlayback()
{
    DoPlayback = true;
    recordingData.MoveToStartOfData(); //Move to start of playback
    StartCoroutine(PlaybackTimer());
}</code></pre></div> This is the same as the recording loop except it calls Next SnapShot(). <div><h4 class=svelte-1x2uof1><i class="fa fa-code"></i> Playback Loop</h4> <pre class=svelte-1x2uof1><code class=language-csharp>
//PLAYBACK LOOP
IEnumerator PlaybackTimer()
{
    while (DoPlayback) // Repeat Until DoPlayback is false
    {
        NextSnapshot();
        yield return new WaitForSeconds(recordingData.RecordedRate / Time.timeScale);
    }
}</code></pre></div> The <strong>NextSnapshot</strong> method simply retrieves the desired transform of the object. <div><h4 class=svelte-1x2uof1><i class="fa fa-code"></i> NextSnapshot()</h4> <pre class=svelte-1x2uof1><code class=language-csharp>
private RecordingData.RecordData? _desiredMoveLocation = null;

//MOVE DESIRED LOCATION TO NEXT LOCATION
private void NextSnapshot()
{
    var data = recordingData.GetNextDataLine();

    if (_desiredMoveLocation.HasValue && !data.HasValue) //If we previously had move location and now we do not
    {
        //END OF REPLAY - YOU MAY WANT TO REMOVE THE REPLAY OBJECT FROM SCENE NOW
    }
    _desiredMoveLocation = data;
}</code></pre></div> We then move the object each update frame using the <strong>Lerp</strong> function (this helps keep the movement smooth). <div><h4 class=svelte-1x2uof1><i class="fa fa-code"></i> Move Object</h4> <pre class=svelte-1x2uof1><code class=language-csharp>
public void Update()
{
    if (_desiredMoveLocation.HasValue)
    {
        var playbackRate = recordingData.RecordedRate;
        var amount = Math.Abs(Time.deltaTime) / playbackRate;
        var p = Vector3.Lerp(Transform.position, _desiredMoveLocation.Value.Position, amount);
        var r = Quaternion.Lerp(Transform.rotation, _desiredMoveLocation.Value.Rotation, amount);

        Transform.position = p;
        Transform.rotation = r;
    }
}</code></pre></div> <div class="svelte-1ecdldb bs-callout bs-callout-primary"><h3 class=svelte-1ecdldb>This is not the only way</h3> There are many many ways of doing this. I am outlining how I did it. <br> I have simplified my implementation for the purposes of this post (to outline roughly how it was done). <br> Any feedback or improvements are welcome :) </div> <div class="svelte-1ecdldb bs-callout bs-callout-primary"><h3 class=svelte-1ecdldb>Have a question?</h3> Feel free to ask me anything (I have overlooked some internal workings in this post). I also have a <a href=https://forum.unity3d.com/threads/wip-time-game-time-travel.435684/ rel=external target=_blank><span>Unity3d Forum WIP post <i class="fa fa-external-link svelte-6iyvyr"></i></span></a> for this game prototype (in progress). <br></div> <div class="svelte-1ecdldb bs-callout bs-callout-primary"><h3 class=svelte-1ecdldb>More Info?</h3> I have not gone into any detail on how the replay data can be saved and loaded between games (I have implemented this in my prototype). <br> I can try and write a post outlining this if this is of interest? </div></div></main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,{}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.946cb0ce.js"}catch(e){main="/client/legacy/client.50c19b8f.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 